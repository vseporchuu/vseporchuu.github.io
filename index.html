<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDLE FARM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
            image-rendering: pixelated;
        }
        
        body {
            background: linear-gradient(135deg, #1a472a, #2e6234);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(34, 40, 49, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 3px solid #555;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 2px solid #5a5a5a;
            margin-bottom: 20px;
        }
        
        .game-title {
            font-size: 32px;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(255, 204, 0, 0.5);
        }
        
        .currency-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .currency-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: rgba(59, 66, 72, 0.8);
            border-radius: 12px;
            font-size: 16px;
            border: 2px solid #777;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .currency-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 5px;
            background: #444;
            border-radius: 50%;
            border: 2px solid #666;
        }
        
        .currency-value {
            font-weight: bold;
            color: #ffcc00;
            font-size: 18px;
        }
        
        .currency-label {
            font-size: 14px;
            color: #aaa;
            margin-top: 5px;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .farm-container {
            background: rgba(49, 57, 64, 0.8);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #666;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
        }
        
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .farm-plot {
            width: 100%;
            aspect-ratio: 1;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="5" y="5" width="90" height="90" fill="%23864d1f" stroke="%23653B15" stroke-width="2"/></svg>');
            background-size: cover;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
            overflow: hidden;
        }
        
        .farm-plot:hover {
            transform: scale(1.05);
        }
        
        .crop {
            position: absolute;
            width: 70%;
            height: 70%;
            bottom: 10%;
            left: 15%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
        }
        
        .crop-level {
            position: absolute;
            top: 5px;
            right: 5px;
            background: gold;
            color: black;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid #b8860b;
        }
        
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0 0 10px 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s;
            width: 0%;
        }
        
        .shop-container {
            background: rgba(49, 57, 64, 0.8);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #666;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            max-height: 500px;
        }
        
        .shop-category {
            margin-bottom: 20px;
        }
        
        .shop-category h3 {
            margin-bottom: 10px;
            color: #ffcc00;
            border-bottom: 1px solid #666;
            padding-bottom: 5px;
        }
        
        .shop-item {
            display: flex;
            align-items: center;
            background: rgba(59, 66, 72, 0.8);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.3s;
            border: 2px solid #666;
        }
        
        .shop-item:hover {
            background: rgba(69, 76, 82, 0.8);
        }
        
        .shop-item-icon {
            width: 50px;
            height: 50px;
            background: #555;
            border-radius: 10px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid #777;
        }
        
        .shop-item-info {
            flex-grow: 1;
        }
        
        .shop-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .shop-item-cost {
            color: #4caf50;
            font-weight: bold;
        }
        
        .shop-item-level {
            color: #ffcc00;
            font-size: 14px;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .action-button {
            padding: 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid #777;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .boost-button {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
        }
        
        .boost-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(247, 147, 30, 0.4);
        }
        
        .collect-button {
            background: linear-gradient(135deg, #388e3c, #4caf50);
            color: white;
        }
        
        .collect-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }
        
        .income-display {
            text-align: center;
            padding: 15px;
            background: rgba(49, 57, 64, 0.8);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #666;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .income-label {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .income-value {
            font-size: 24px;
            font-weight: bold;
            color: #4caf50;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            color: #aaa;
            font-size: 14px;
        }
        
        /* Анимации */
        @keyframes grow {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .growing {
            animation: grow 0.5s ease-in-out;
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .currency-display {
                grid-template-columns: 1fr;
            }
            
            .farm-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="game-title">IDLE FARM</h1>
        </div>
        
        <div class="currency-display">
            <div class="currency-item">
                <div class="currency-icon">💰</div>
                <div class="currency-value" id="cash-value">5.21ac</div>
                <div class="currency-label">CASH</div>
            </div>
            
            <div class="currency-item">
                <div class="currency-icon">⭐</div>
                <div class="currency-value" id="star-value">16</div>
                <div class="currency-label">STARS</div>
            </div>
            
            <div class="currency-item">
                <div class="currency-icon">🌲</div>
                <div class="currency-value" id="lumber-value">500</div>
                <div class="currency-label">LUMBER</div>
            </div>
        </div>
        
        <div class="income-display">
            <div class="income-label">IDLE INCOME</div>
            <div class="income-value" id="income-value">634aa/s</div>
        </div>
        
        <div class="game-area">
            <div class="farm-container">
                <h3>YOUR FARM</h3>
                <div class="farm-grid" id="farm-grid">
                    <!-- Farm plots will be generated here -->
                </div>
            </div>
            
            <div class="shop-container">
                <div class="shop-category">
                    <h3>🛒 SHOP</h3>
                    <div class="shop-item" onclick="buyItem('carrot')">
                        <div class="shop-item-icon">🥕</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">Carrot Seeds</div>
                            <div class="shop-item-cost">Cost: 💰 10</div>
                            <div class="shop-item-level">Level: 1</div>
                        </div>
                    </div>
                    
                    <div class="shop-item" onclick="buyItem('potato')">
                        <div class="shop-item-icon">🥔</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">Potato Seeds</div>
                            <div class="shop-item-cost">Cost: 💰 15</div>
                            <div class="shop-item-level">Level: 1</div>
                        </div>
                    </div>
                    
                    <div class="shop-item" onclick="buyItem('tomato')">
                        <div class="shop-item-icon">🍅</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">Tomato Seeds</div>
                            <div class="shop-item-cost">Cost: 💰 25</div>
                            <div class="shop-item-level">Level: 1</div>
                        </div>
                    </div>
                </div>
                
                <div class="shop-category">
                    <h3>🚜 UPGRADES</h3>
                    <div class="shop-item" onclick="buyUpgrade('plot')">
                        <div class="shop-item-icon">🌾</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">New Farm Plot</div>
                            <div class="shop-item-cost">Cost: 💰 50</div>
                            <div class="shop-item-level">Plots: 4/8</div>
                        </div>
                    </div>
                    
                    <div class="shop-item" onclick="buyUpgrade('speed')">
                        <div class="shop-item-icon">⚡</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">Growth Speed</div>
                            <div class="shop-item-cost">Cost: 💰 100</div>
                            <div class="shop-item-level">Level: 1</div>
                        </div>
                    </div>
                    
                    <div class="shop-item" onclick="buyUpgrade('value')">
                        <div class="shop-item-icon">💰</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">Crop Value</div>
                            <div class="shop-item-cost">Cost: 💰 120</div>
                            <div class="shop-item-level">Level: 1</div>
                        </div>
                    </div>
                </div>
                
                <div class="shop-category">
                    <h3>🎁 CHESTS</h3>
                    <div class="shop-item" onclick="buyChest('basic')">
                        <div class="shop-item-icon">📦</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">Basic Chest</div>
                            <div class="shop-item-cost">Cost: ⭐ 5</div>
                            <div class="shop-item-level">Common rewards</div>
                        </div>
                    </div>
                    
                    <div class="shop-item" onclick="buyChest('premium')">
                        <div class="shop-item-icon">💎</div>
                        <div class="shop-item-info">
                            <div class="shop-item-name">Premium Chest</div>
                            <div class="shop-item-cost">Cost: ⭐ 15</div>
                            <div class="shop-item-level">Rare rewards</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <div class="action-button boost-button" onclick="activateBoost()">
                BOOST! (⭐ 3)
            </div>
            <div class="action-button collect-button" onclick="collectAll()">
                COLLECT ALL (💰 50aa)
            </div>
        </div>
        
        <div class="footer">
            <p>IDLE FARM © 2023 | Telegram Mini App</p>
        </div>
    </div>

    <script>
        // Игровые данные
        let gameData = {
            cash: 5210000000000, // 5.21ac
            stars: 16,
            lumber: 500,
            income: 634000000000, // 634aa/s
            lastUpdate: Date.now(),
            plots: [
                { id: 1, crop: null, growth: 0, level: 1 },
                { id: 2, crop: null, growth: 0, level: 1 },
                { id: 3, crop: null, growth: 0, level: 1 },
                { id: 4, crop: null, growth: 0, level: 1 },
                { id: 5, unlocked: false },
                { id: 6, unlocked: false },
                { id: 7, unlocked: false },
                { id: 8, unlocked: false }
            ],
            upgrades: {
                speed: 1,
                value: 1,
                autoCollect: false
            },
            crops: {
                carrot: { name: "Carrot", growthTime: 30, value: 10, icon: "🥕" },
                potato: { name: "Potato", growthTime: 45, value: 15, icon: "🥔" },
                tomato: { name: "Tomato", growthTime: 60, value: 25, icon: "🍅" }
            },
            boosts: {
                active: false,
                timeLeft: 0
            }
        };
        
        // Форматирование чисел в игровом стиле
        function formatNumber(num) {
            if (num >= 1e18) return (num / 1e18).toFixed(2) + 'ac';
            if (num >= 1e15) return (num / 1e15).toFixed(2) + 'ab';
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'aa';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'T';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            return num.toFixed(2);
        }
        
        // Обновление интерфейса
        function updateUI() {
            document.getElementById('cash-value').textContent = formatNumber(gameData.cash);
            document.getElementById('star-value').textContent = gameData.stars;
            document.getElementById('lumber-value').textContent = gameData.lumber;
            document.getElementById('income-value').textContent = formatNumber(gameData.income) + '/s';
            
            // Обновление грядок
            const farmGrid = document.getElementById('farm-grid');
            farmGrid.innerHTML = '';
            
            gameData.plots.forEach(plot => {
                const plotElement = document.createElement('div');
                plotElement.className = 'farm-plot';
                plotElement.onclick = () => harvestPlot(plot.id);
                
                if (plot.unlocked === false) {
                    plotElement.innerHTML = `
                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.7); color: #fff; font-weight: bold; border-radius: 10px;">
                            🔒<br>💰 ${formatNumber(50 * Math.pow(2, plot.id - 1))}
                        </div>
                    `;
                    plotElement.onclick = () => unlockPlot(plot.id);
                } else if (plot.crop) {
                    const crop = gameData.crops[plot.crop];
                    const growthPercent = (plot.growth / (crop.growthTime / gameData.upgrades.speed)) * 100;
                    
                    plotElement.innerHTML = `
                        <div class="crop" style="background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><text x=\"50\" y=\"80\" font-size=\"70\" text-anchor=\"middle\">${crop.icon}</text></svg>')"></div>
                        <div class="crop-level">${plot.level}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${growthPercent}%"></div>
                        </div>
                    `;
                    
                    if (growthPercent >= 100) {
                        plotElement.classList.add('pulse');
                    }
                }
                
                farmGrid.appendChild(plotElement);
            });
        }
        
        // Покупка семян
        function buyItem(cropType) {
            const crop = gameData.crops[cropType];
            const cost = crop.value * 10;
            
            if (gameData.cash >= cost) {
                const emptyPlot = gameData.plots.find(plot => plot.unlocked !== false && plot.crop === null);
                
                if (emptyPlot) {
                    gameData.cash -= cost;
                    emptyPlot.crop = cropType;
                    emptyPlot.growth = 0;
                    updateUI();
                    saveGame();
                } else {
                    alert('No empty plots available! Buy more plots.');
                }
            } else {
                alert('Not enough cash!');
            }
        }
        
        // Покупка улучшения
        function buyUpgrade(upgradeType) {
            let cost = 0;
            
            switch(upgradeType) {
                case 'plot':
                    const nextPlot = gameData.plots.find(plot => plot.unlocked === false);
                    if (nextPlot) {
                        cost = 50 * Math.pow(2, nextPlot.id - 1);
                        if (gameData.cash >= cost) {
                            gameData.cash -= cost;
                            nextPlot.unlocked = true;
                            nextPlot.crop = null;
                            nextPlot.growth = 0;
                            nextPlot.level = 1;
                        } else {
                            alert('Not enough cash!');
                            return;
                        }
                    } else {
                        alert('All plots already unlocked!');
                        return;
                    }
                    break;
                    
                case 'speed':
                    cost = 100 * Math.pow(2, gameData.upgrades.speed - 1);
                    if (gameData.cash >= cost) {
                        gameData.cash -= cost;
                        gameData.upgrades.speed += 0.5;
                    } else {
                        alert('Not enough cash!');
                        return;
                    }
                    break;
                    
                case 'value':
                    cost = 120 * Math.pow(2, gameData.upgrades.value - 1);
                    if (gameData.cash >= cost) {
                        gameData.cash -= cost;
                        gameData.upgrades.value += 0.5;
                    } else {
                        alert('Not enough cash!');
                        return;
                    }
                    break;
            }
            
            updateUI();
            saveGame();
        }
        
        // Сбор урожая с грядки
        function harvestPlot(plotId) {
            const plot = gameData.plots.find(p => p.id === plotId);
            if (plot && plot.crop) {
                const crop = gameData.crops[plot.crop];
                const growthNeeded = crop.growthTime / gameData.upgrades.speed;
                
                if (plot.growth >= growthNeeded) {
                    const value = crop.value * plot.level * gameData.upgrades.value;
                    gameData.cash += value;
                    plot.growth = 0;
                    
                    // Анимация сбора урожая
                    const plotElement = document.querySelector(`.farm-plot:nth-child(${plotId})`);
                    if (plotElement) {
                        plotElement.classList.remove('pulse');
                        plotElement.classList.add('growing');
                        setTimeout(() => plotElement.classList.remove('growing'), 500);
                    }
                    
                    updateUI();
                    saveGame();
                }
            }
        }
        
        // Сбор всего урожая
        function collectAll() {
            let collected = 0;
            gameData.plots.forEach(plot => {
                if (plot && plot.crop) {
                    const crop = gameData.crops[plot.crop];
                    const growthNeeded = crop.growthTime / gameData.upgrades.speed;
                    
                    if (plot.growth >= growthNeeded) {
                        const value = crop.value * plot.level * gameData.upgrades.value;
                        gameData.cash += value;
                        plot.growth = 0;
                        collected += value;
                    }
                }
            });
            
            if (collected > 0) {
                updateUI();
                saveGame();
                alert(`Collected ${formatNumber(collected)} cash!`);
            } else {
                alert('No crops ready for harvest!');
            }
        }
        
        // Разблокировка грядки
        function unlockPlot(plotId) {
            const plot = gameData.plots.find(p => p.id === plotId);
            if (plot && plot.unlocked === false) {
                const cost = 50 * Math.pow(2, plotId - 1);
                if (gameData.cash >= cost) {
                    gameData.cash -= cost;
                    plot.unlocked = true;
                    plot.crop = null;
                    plot.growth = 0;
                    plot.level = 1;
                    updateUI();
                    saveGame();
                } else {
                    alert(`Need ${formatNumber(cost)} cash to unlock this plot!`);
                }
            }
        }
        
        // Активация буста
        function activateBoost() {
            if (gameData.stars >= 3) {
                gameData.stars -= 3;
                gameData.boosts.active = true;
                gameData.boosts.timeLeft = 300; // 5 минут
                
                // Удваиваем доход на время буста
                gameData.income *= 2;
                
                updateUI();
                saveGame();
                alert('Boost activated! Income doubled for 5 minutes.');
            } else {
                alert('Not enough stars!');
            }
        }
        
        // Покупка сундука
        function buyChest(chestType) {
            let cost = chestType === 'basic' ? 5 : 15;
            
            if (gameData.stars >= cost) {
                gameData.stars -= cost;
                
                // Рандомные награды из сундука
                let rewardText = "You found: ";
                const rewards = [];
                
                if (chestType === 'basic') {
                    // Базовый сундук
                    rewards.push(`${formatNumber(1000000000000)} cash`);
                    gameData.cash += 1000000000000;
                    
                    if (Math.random() > 0.5) {
                        rewards.push("5 lumber");
                        gameData.lumber += 5;
                    }
                } else {
                    // Премиум сундук
                    rewards.push(`${formatNumber(5000000000000)} cash`);
                    gameData.cash += 5000000000000;
                    
                    rewards.push("20 lumber");
                    gameData.lumber += 20;
                    
                    if (Math.random() > 0.7) {
                        rewards.push("1 star");
                        gameData.stars += 1;
                    }
                }
                
                rewardText += rewards.join(", ");
                alert(rewardText);
                
                updateUI();
                saveGame();
            } else {
                alert('Not enough stars!');
            }
        }
        
        // Игровой цикл
        function gameLoop() {
            const now = Date.now();
            const deltaTime = (now - gameData.lastUpdate) / 1000;
            gameData.lastUpdate = now;
            
            // Пассивный доход
            gameData.cash += gameData.income * deltaTime;
            
            // Обновление роста растений
            gameData.plots.forEach(plot => {
                if (plot && plot.crop) {
                    plot.growth += deltaTime;
                }
            });
            
            // Обновление буста
            if (gameData.boosts.active) {
                gameData.boosts.timeLeft -= deltaTime;
                if (gameData.boosts.timeLeft <= 0) {
                    gameData.boosts.active = false;
                    gameData.income /= 2; // Возвращаем обычный доход
                    alert('Boost has ended!');
                }
            }
            
            updateUI();
            requestAnimationFrame(gameLoop);
        }
        
        // Сохранение игры
        function saveGame() {
            localStorage.setItem('idleFarmSave', JSON.stringify(gameData));
        }
        
        // Загрузка игры
        function loadGame() {
            const save = localStorage.getItem('idleFarmSave');
            if (save) {
                gameData = JSON.parse(save);
                gameData.lastUpdate = Date.now();
            }
        }
        
        // Инициализация игры
        function initGame() {
            loadGame();
            updateUI();
            gameData.lastUpdate = Date.now();
            requestAnimationFrame(gameLoop);
            
            // Автосохранение каждые 30 секунд
            setInterval(saveGame, 30000);
        }
        
        // Запуск игры при загрузке страницы
        window.onload = initGame;
    </script>
</body>
</html>
