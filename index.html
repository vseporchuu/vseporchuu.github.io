<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tanki Online Stats</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        
        
        /* Новый дизайн главной страницы */
        .chat-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 8px;
        }
        
        .rank-progress {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .rank-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 5px;
        }
        
        .achievement-badge {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            color: white;
            font-size: 18px;
        }
        
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }
        
        .achievement-item {
            text-align: center;
            padding: 10px;
        }
        
        .achievement-name {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        .violation-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--divider);
            display: flex;
            justify-content: space-between;
        }
        
        .violation-item:last-child {
            border-bottom: none;
        }
        
        .violation-reason {
            font-weight: 500;
        }
        
        .violation-date {
            color: var(--text-light);
            font-size: 12px;
        }
        
        .common-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .common-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px 16px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--divider);
            transition: all 0.3s ease;
        }
        
        .common-card:active {
            transform: scale(0.98);
            background: rgba(77, 182, 172, 0.05);
        }
        
        .common-card i {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .common-card-title {
            font-weight: 600;
            color: var(--text);
            font-size: 15px;
        }
        
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }
        
        .search-input {
            width: 100%;
            padding: 14px 16px 14px 48px;
            border: 1px solid var(--divider);
            border-radius: 12px;
            font-size: 15px;
            transition: border-color 0.3s;
            background: var(--card-bg);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 12px;
        }
        
        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .theme-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .theme-slider {
            background-color: var(--primary);
        }
        
        input:checked + .theme-slider:before {
            transform: translateX(26px);
        }
        
        .privacy-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--divider);
        }
        
        .privacy-item:last-child {
            border-bottom: none;
        }
        
        /* Темная тема */
        body.dark-theme {
            --text: #FFFFFF;
            --text-light: #B0BEC5;
            --bg: #121212;
            --card-bg: #1E1E1E;
            --divider: #424242;
        }
        
        .dark-theme .common-card {
            background: #2D2D2D;
        }
        
        .dark-theme .stat-item {
            background: rgba(77, 182, 172, 0.15);
            border-color: rgba(77, 182, 172, 0.3);
        }
        
        .dark-theme .top-card {
            background: #2D2D2D;
            border-color: #424242;
        }
        
        .dark-theme .supply-item {
            background: rgba(255, 152, 0, 0.15);
            border-color: rgba(255, 152, 0, 0.3);
        }
        
        .dark-theme .section-title {
            color: var(--primary-light);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Шапка профиля -->
        <div class="profile-header" id="profileHeader">
            <div class="profile-avatar" id="userAvatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="profile-info">
                <div class="profile-name" id="userName">Загрузка...</div>
                <div class="tanki-info">
                    <div class="tanki-rank" id="tankiRank">Чат статистика</div>
                    <div class="tanki-nickname" id="tankiNickname"></div>
                </div>
            </div>
        </div>
        
        <!-- Поиск пользователя -->
        <div class="search-container" id="userSearchContainer">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="userSearchInput" placeholder="Поиск пользователя">
        </div>
        
        <!-- Контейнеры вкладок -->
        <div class="tab-content active" id="homeTab">
            <!-- Статистика чата -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-comments"></i>
                    Статистика чата
                </h2>
                
                <div class="chat-stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Звание</div>
                        <div class="stat-value" id="chatRank">Рекрут</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Опыт</div>
                        <div class="stat-value" id="chatXP">125</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Сообщения</div>
                        <div class="stat-value" id="messagesCount">125</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Карма</div>
                        <div class="stat-value" id="karmaPoints">100%</div>
                    </div>
                </div>
            </div>
            
            <!-- Прогресс звания -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-tasks"></i>
                    Прогресс до следующего звания
                </h2>
                <div class="rank-progress">
                    <div class="rank-progress-bar" id="rankProgressBar" style="width: 25%"></div>
                </div>
                <div class="stat-subvalue" style="text-align: center; margin-top: 8px;">
                    <span id="currentXP">125</span> / <span id="nextRankXP">500</span> опыта
                </div>
            </div>
            
            <!-- Достижения -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-medal"></i>
                    Достижения в чате
                </h2>
                
                <div class="achievement-grid">
                    <div class="achievement-item">
                        <div class="achievement-badge">
                            <i class="fas fa-comment"></i>
                        </div>
                        <div class="achievement-name">Первое сообщение</div>
                    </div>
                    <div class="achievement-item">
                        <div class="achievement-badge">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="achievement-name">Активный участник</div>
                    </div>
                    <div class="achievement-item">
                        <div class="achievement-badge">
                            <i class="fas fa-gem"></i>
                        </div>
                        <div class="achievement-name">100 сообщений</div>
                    </div>
                    <div class="achievement-item">
                        <div class="achievement-badge">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="achievement-name">Ветеран чата</div>
                    </div>
                </div>
            </div>
            
            <!-- Карма и нарушения -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-balance-scale"></i>
                    Карма и нарушения
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Штрафные очки</div>
                        <div class="stat-value" id="penaltyPoints">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Муты</div>
                        <div class="stat-value" id="mutesCount">0</div>
                    </div>
                </div>
                
                <div style="margin-top: 16px;">
                    <h3 class="section-title" style="margin-bottom: 8px; font-size: 14px;">
                        <i class="fas fa-history"></i>
                        Последние нарушения
                    </h3>
                    <div id="lastViolations">
                        <div class="violation-item">
                            <div class="violation-reason">Нарушений нет</div>
                            <div class="violation-date"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Вкладка "Игровой аккаунт" -->
        <div class="tab-content" id="gameTab">
            <!-- Привязка аккаунта -->
            <div class="bind-section">
                <h2 class="section-title">
                    <i class="fas fa-link"></i>
                    Привязка аккаунта
                </h2>
                <p>Введите ваш никнейм в Tanki Online</p>
                
                <div class="input-group">
                    <input type="text" class="nickname-input" id="nicknameInput" placeholder="Ваш никнейм">
                    <button class="bind-btn" id="bindBtn">Привязать</button>
                </div>
                <div class="error-message" id="errorMessage">
                    <i class="fas fa-exclamation-circle"></i> 
                    <span id="errorText">Ошибка при загрузке данных</span>
                </div>
            </div>
            
            <!-- Статистика -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Основная статистика
                </h2>
                
                <div class="stats-grid" id="mainStats">
                    <div class="stat-item">
                        <div class="stat-label">Бои</div>
                        <div class="stat-value" id="battlesStat">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Победы</div>
                        <div class="stat-value" id="winsStat">0</div>
                        <div class="stat-subvalue" id="winrateStat">0%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Уничтожено</div>
                        <div class="stat-value" id="destroyedStat">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Опыт</div>
                        <div class="stat-value" id="experienceStat">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Рейтинги -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-trophy"></i>
                    Рейтинги
                </h2>
                
                <div class="stats-grid" id="ratingsContainer">
                    <div class="stat-item">
                        <div class="stat-label">По опыту</div>
                        <div class="stat-value" id="expRating">#0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Голдоловов</div>
                        <div class="stat-value" id="goldHunters">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">По кристаллам</div>
                        <div class="stat-value" id="crystalsRating">#0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">По эффективности</div>
                        <div class="stat-value" id="efficiencyRating">#0</div>
                    </div>
                </div>
            </div>
            
            <!-- Топы -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-crown"></i>
                    Топы
                </h2>
                
                <div class="top-grid">
                    <div class="top-card">
                        <div class="top-card-title">
                            <i class="fas fa-gun"></i>
                            Пушки
                        </div>
                        <div id="topGunsContainer">
                            <div class="top-item">
                                <div class="top-icon">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                                <div class="top-info">
                                    <div class="top-name">Загрузка...</div>
                                    <div class="top-value">0 часов</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="top-card">
                        <div class="top-card-title">
                            <i class="fas fa-paint-roller"></i>
                            Краски
                        </div>
                        <div id="topPaintsContainer">
                            <div class="top-item">
                                <div class="top-icon">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                                <div class="top-info">
                                    <div class="top-name">Загрузка...</div>
                                    <div class="top-value">0 часов</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Припасы -->
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-box-open"></i>
                    Припасы
                </h2>
                
                <div class="supplies-grid" id="suppliesContainer">
                    <div class="supply-item">
                        <div class="supply-label">Ремкомплекты</div>
                        <div class="supply-value" id="repairKit">0</div>
                    </div>
                    <div class="supply-item">
                        <div class="supply-label">Бронирование</div>
                        <div class="supply-value" id="armor">0</div>
                    </div>
                    <div class="supply-item">
                        <div class="supply-label">Двойной урон</div>
                        <div class="supply-value" id="doubleDamage">0</div>
                    </div>
                    <div class="supply-item">
                        <div class="supply-label">Ускорение</div>
                        <div class="supply-value" id="speedBoost">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Вкладка "Общее" -->
        <div class="tab-content" id="commonTab">
            <div class="common-grid">
                <div class="common-card">
                    <i class="fas fa-newspaper"></i>
                    <div class="common-card-title">Новости</div>
                </div>
                <div class="common-card">
                    <i class="fas fa-trophy"></i>
                    <div class="common-card-title">Киберспорт</div>
                </div>
                <div class="common-card">
                    <i class="fas fa-flag-checkered"></i>
                    <div class="common-card-title">Вызов принят</div>
                </div>
                <div class="common-card">
                    <i class="fas fa-book"></i>
                    <div class="common-card-title">Википедия</div>
                </div>
                <div class="common-card">
                    <i class="fas fa-users"></i>
                    <div class="common-card-title">Чат танкистов</div>
                </div>
                <div class="common-card">
                    <i class="fas fa-video"></i>
                    <div class="common-card-title">Видео-гайд</div>
                </div>
            </div>
        </div>
        
        <!-- Вкладка "Рейтинг" -->
        <div class="tab-content" id="ratingTab">
            <div class="bind-section">
                <h2 class="section-title">
                    <i class="fas fa-search"></i>
                    Поиск игрока
                </h2>
                <p>Введите никнейм в Tanki Online</p>
                
                <div class="input-group">
                    <input type="text" class="nickname-input" id="ratingNicknameInput" placeholder="Никнейм игрока">
                    <button class="bind-btn" id="ratingSearchBtn">Поиск</button>
                </div>
                <div class="error-message" id="ratingErrorMessage">
                    <i class="fas fa-exclamation-circle"></i> 
                    <span id="ratingErrorText">Ошибка при загрузке данных</span>
                </div>
            </div>
            
            <!-- Статистика игрока -->
            <div class="stats-card" id="playerStats" style="display: none;">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Статистика игрока
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Бои</div>
                        <div class="stat-value" id="playerBattles">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Победы</div>
                        <div class="stat-value" id="playerWins">0</div>
                        <div class="stat-subvalue" id="playerWinrate">0%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Уничтожено</div>
                        <div class="stat-value" id="playerDestroyed">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Опыт</div>
                        <div class="stat-value" id="playerExperience">0</div>
                    </div>
                </div>
            </div>
            
            <!-- Достижения игрока -->
            <div class="stats-card" id="achievementsCard" style="display: none;">
                <h2 class="section-title">
                    <i class="fas fa-medal"></i>
                    Достижения игрока
                </h2>
                
                <div class="achievement-grid" id="achievementsGrid"></div>
            </div>
        </div>
        
        <!-- Вкладка "Настройки" -->
        <div class="tab-content" id="settingsTab">
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-moon"></i>
                    Внешний вид
                </h2>
                
                <div class="privacy-item">
                    <div>
                        <i class="fas fa-palette"></i>
                        <span style="margin-left: 10px;">Темная тема</span>
                    </div>
                    <label class="theme-switch">
                        <input type="checkbox" id="themeSwitch">
                        <span class="theme-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-lock"></i>
                    Приватность
                </h2>
                
                <div class="privacy-item">
                    <div>
                        <i class="fas fa-user-shield"></i>
                        <span style="margin-left: 10px;">Скрыть профиль</span>
                    </div>
                    <label class="theme-switch">
                        <input type="checkbox" id="privacySwitch">
                        <span class="theme-slider"></span>
                    </label>
                </div>
                
                <div class="privacy-item">
                    <div>
                        <i class="fas fa-eye"></i>
                        <span style="margin-left: 10px;">Показывать игровой аккаунт</span>
                    </div>
                    <label class="theme-switch">
                        <input type="checkbox" id="showGameAccount" checked>
                        <span class="theme-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="stats-card">
                <h2 class="section-title">
                    <i class="fas fa-info-circle"></i>
                    О приложении
                </h2>
                
                <div style="padding: 16px 0; line-height: 1.8;">
                    <p style="margin-bottom: 12px;">
                        <strong>Tanki Online Stats</strong><br>
                        Версия 1.5.0<br>
                        © 2025 Tanki Community
                    </p>
                    <p>
                        Приложение для просмотра статистики игроков
                        Tanki Online и управления профилем в чате
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Нижняя панель -->
        <div class="nav-tabs">
            <div class="tab-item active" data-tab="homeTab">
                <i class="fas fa-home"></i>
                <span>Главная</span>
            </div>
            <div class="tab-item" data-tab="gameTab">
                <i class="fas fa-gamepad"></i>
                <span>Игровой акк</span>
            </div>
            <div class="tab-item" data-tab="commonTab">
                <i class="fas fa-th-large"></i>
                <span>Общее</span>
            </div>
            <div class="tab-item" data-tab="ratingTab">
                <i class="fas fa-trophy"></i>
                <span>Рейтинг</span>
            </div>
            <div class="tab-item" data-tab="settingsTab">
                <i class="fas fa-cog"></i>
                <span>Настройки</span>
            </div>
        </div>
    </div>
    
    <!-- Toast уведомление -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toastMessage">Сообщение</span>
    </div>
    
    <script>
        // Инициализация Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // Получаем данные пользователя Telegram
        const user = tg.initDataUnsafe.user;
        
        // Элементы интерфейса
        const elements = {
            userName: document.getElementById('userName'),
            userAvatar: document.getElementById('userAvatar'),
            tankiRank: document.getElementById('tankiRank'),
            tankiNickname: document.getElementById('tankiNickname'),
            nicknameInput: document.getElementById('nicknameInput'),
            bindBtn: document.getElementById('bindBtn'),
            errorMessage: document.getElementById('errorMessage'),
            errorText: document.getElementById('errorText'),
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toastMessage'),
            // Статистика чата
            chatRank: document.getElementById('chatRank'),
            chatXP: document.getElementById('chatXP'),
            messagesCount: document.getElementById('messagesCount'),
            karmaPoints: document.getElementById('karmaPoints'),
            rankProgressBar: document.getElementById('rankProgressBar'),
            currentXP: document.getElementById('currentXP'),
            nextRankXP: document.getElementById('nextRankXP'),
            penaltyPoints: document.getElementById('penaltyPoints'),
            mutesCount: document.getElementById('mutesCount'),
            lastViolations: document.getElementById('lastViolations'),
            // Настройки
            themeSwitch: document.getElementById('themeSwitch'),
            privacySwitch: document.getElementById('privacySwitch'),
            showGameAccount: document.getElementById('showGameAccount'),
            // Рейтинг
            ratingNicknameInput: document.getElementById('ratingNicknameInput'),
            ratingSearchBtn: document.getElementById('ratingSearchBtn'),
            ratingErrorMessage: document.getElementById('ratingErrorMessage'),
            ratingErrorText: document.getElementById('ratingErrorText'),
            playerStats: document.getElementById('playerStats'),
            achievementsCard: document.getElementById('achievementsCard'),
            achievementsGrid: document.getElementById('achievementsGrid'),
            // Поиск пользователей
            userSearchInput: document.getElementById('userSearchInput')
        };
        
        // Показываем toast уведомление
        function showToast(message, type = 'info') {
            elements.toast.className = `toast ${type}`;
            elements.toastMessage.textContent = message;
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }
        
        // Обновляем шапку профиля
        function updateProfileHeader() {
            if (user) {
                // Обновляем имя
                const userName = user.first_name || user.username || 'Пользователь';
                elements.userName.textContent = userName;
                
                // Обновляем аватар
                if (user.photo_url) {
                    elements.userAvatar.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = user.photo_url;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.borderRadius = '50%';
                    elements.userAvatar.appendChild(img);
                }
            } else {
                elements.userName.textContent = 'Пользователь Telegram';
            }
        }
        
        // Генерация случайной статистики чата
        function generateChatStats() {
            // Случайный опыт (от 50 до 2000)
            const xp = Math.floor(Math.random() * 1950) + 50;
            elements.chatXP.textContent = xp;
            elements.messagesCount.textContent = xp;
            
            // Определение звания по опыту
            let rank, nextRankXP;
            if (xp < 100) {
                rank = "Рекрут";
                nextRankXP = 100;
            } else if (xp < 300) {
                rank = "Солдат";
                nextRankXP = 300;
            } else if (xp < 600) {
                rank = "Сержант";
                nextRankXP = 600;
            } else if (xp < 1000) {
                rank = "Лейтенант";
                nextRankXP = 1000;
            } else if (xp < 1500) {
                rank = "Капитан";
                nextRankXP = 1500;
            } else {
                rank = "Майор";
                nextRankXP = 2000;
            }
            
            elements.chatRank.textContent = rank;
            elements.currentXP.textContent = xp;
            elements.nextRankXP.textContent = nextRankXP;
            
            // Прогресс до следующего звания
            const progress = Math.min(100, Math.round((xp / nextRankXP) * 100));
            elements.rankProgressBar.style.width = `${progress}%`;
            
            // Карма и нарушения
            const penaltyPoints = Math.floor(Math.random() * 10);
            const mutesCount = Math.floor(Math.random() * 3);
            
            elements.penaltyPoints.textContent = penaltyPoints;
            elements.mutesCount.textContent = mutesCount;
            
            // Последние нарушения
            if (mutesCount > 0) {
                const violations = [
                    { reason: "Нецензурная лексика", date: "12.07.2025" },
                    { reason: "Спам", date: "05.07.2025" },
                    { reason: "Оскорбление игроков", date: "28.06.2025" }
                ].slice(0, mutesCount);
                
                elements.lastViolations.innerHTML = violations.map(v => `
                    <div class="violation-item">
                        <div class="violation-reason">${v.reason}</div>
                        <div class="violation-date">${v.date}</div>
                    </div>
                `).join('');
            }
        }
        
        // Проверка достижений игрока
        function checkAchievements(paints) {
            const achievements = [];
            const paintNames = paints.map(p => p.name.toLowerCase());
            
            // Киберспортсмен
            const esportsPaints = ['звезда', 'кислота', 'гладиатор', 'импульс', 'призма', 'ветеран', 'счастливая семёрка'];
            if (esportsPaints.some(p => paintNames.includes(p))) {
                achievements.push({ 
                    name: "Киберспортсмен", 
                    icon: "fas fa-trophy" 
                });
            }
            
            // Помощник игры
            const helperPaints = ['помощник', 'микросхема', 'рубин', 'арамид', 'оператор', 'сапфир', 'аллигатор', 'репортёр'];
            if (helperPaints.some(p => paintNames.includes(p))) {
                achievements.push({ 
                    name: "Помощник игры", 
                    icon: "fas fa-hands-helping" 
                });
            }
            
            // Ютубер ТО
            if (paintNames.includes('ютубер то')) {
                achievements.push({ 
                    name: "Ютубер ТО", 
                    icon: "fas fa-video" 
                });
            }
            
            // Администратор игры
            const adminPaints = ['пламя', 'пламя 2.0'];
            if (adminPaints.some(p => paintNames.includes(p))) {
                achievements.push({ 
                    name: "Администратор игры", 
                    icon: "fas fa-shield-alt" 
                });
            }
            
            // Паркурист
            const parkourPaints = ['оникс', 'орёл', 'облака', 'глайд', 'феникс', 'блейз', 'аэро'];
            if (parkourPaints.some(p => paintNames.includes(p))) {
                achievements.push({ 
                    name: "Паркурист", 
                    icon: "fas fa-running" 
                });
            }
            
            // Чемпион
            if (paintNames.includes('чемпион')) {
                achievements.push({ 
                    name: "Чемпион Major", 
                    icon: "fas fa-medal" 
                });
            }
            
            // Призеры
            if (paintNames.includes('бронза')) {
                achievements.push({ 
                    name: "Бронзовый призер", 
                    icon: "fas fa-award" 
                });
            }
            
            if (paintNames.includes('серебро')) {
                achievements.push({ 
                    name: "Серебряный призер", 
                    icon: "fas fa-award" 
                });
            }
            
            return achievements;
        }
        
        // Переключение вкладок
        function setupTabNavigation() {
            const tabItems = document.querySelectorAll('.tab-item');
            
            tabItems.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Убираем активный класс со всех вкладок
                    tabItems.forEach(item => item.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Добавляем активный класс текущей вкладке
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // Переключение темы
        function setupThemeSwitcher() {
            elements.themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('dark-theme');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.remove('dark-theme');
                    localStorage.setItem('theme', 'light');
                }
            });
            
            // Загрузка сохраненной темы
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                elements.themeSwitch.checked = true;
                document.body.classList.add('dark-theme');
            }
        }
        
        // Инициализация приложения
        function initApp() {
            // Настройка Telegram Web App
            if (tg.platform !== 'unknown') {
                tg.expand();
                tg.enableClosingConfirmation();
                tg.setHeaderColor('#00897B');
                tg.setBackgroundColor('#F5F7FA');
            }
            
            updateProfileHeader();
            generateChatStats();
            setupTabNavigation();
            setupThemeSwitcher();
            
            // Загрузка сохраненных настроек приватности
            const privacySetting = localStorage.getItem('privacy');
            if (privacySetting === 'hidden') {
                elements.privacySwitch.checked = true;
            }
            
            const showGameSetting = localStorage.getItem('showGameAccount');
            if (showGameSetting === 'false') {
                elements.showGameAccount.checked = false;
            }
            
            // Обработчики для настроек
            elements.privacySwitch.addEventListener('change', function() {
                localStorage.setItem('privacy', this.checked ? 'hidden' : 'visible');
                showToast(this.checked ? 'Профиль скрыт' : 'Профиль виден всем', 'success');
            });
            
            elements.showGameAccount.addEventListener('change', function() {
                localStorage.setItem('showGameAccount', this.checked);
                showToast(this.checked ? 'Игровой аккаунт виден' : 'Игровой аккаунт скрыт', 'success');
            });
            
            // Обработчик поиска пользователей
            elements.userSearchInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    showToast(`Поиск пользователя: ${this.value}`, 'info');
                }
            });
        }
        
        // Запуск приложения
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
